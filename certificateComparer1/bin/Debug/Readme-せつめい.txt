//----------------------------//
//    サーバ証明書比較くん    //
//----------------------------//



■はじめに
本ツールは、[ルート証明書]⇔[中間証明書]⇔[サーバ証明書]⇔[サーバ秘密鍵]の対応を確認するツールです。
違うサーバ用の証明書や鍵を使ってしまうなどのミスを防ぐための確認に使用できます。



■使い方
.net Framework 4.5以降をインストールします。
本ツールを起動できないときは、
インターネットから入手してインストールしておいてください。

certificateComparer1.exeを実行します。

1.SecretKey欄で秘密鍵ファイルを指定します。(任意)
2.Server Certificate欄でサーバ証明書を指定します(任意)
3.Intermediate Certificate欄で中間証明書を指定します(任意)
4.Root Certificate欄でルート証明書を指定します(任意)
5.Compareボタンを押します。
6.秘密鍵にパスワードがかかっている場合は、
パスワード入力のプロンプトが出るので入力します。

水色で"OK"と出れば、対象の両者は互いに正しく対応したものです。
赤色で"NG"と出れば、対象の両者は誤った組み合わせです。

システムによっては、同一ドメインのサーバ複数台に
全く同一の証明書を使用することがあるかと思います。
その場合は、証明書間で差分が無いので、比較してもOKと出ます。
(全く同じ証明書なので問題なし)



■動作の仕組み
本ツールはopensslコマンドを内部で実行しています。

[サーバ秘密鍵]と[サーバ証明書]の比較は、以下２コマンドを実行し、結果が一致することを確認しています。
　openssl rsa -noout -modulus -in [サーバ秘密鍵]     (サーバ秘密鍵のModulus値)
　openssl x509 -noout -modulus -in [サーバ証明書]     (サーバ証明書のModulus値)


[サーバ証明書]と[中間証明書]の比較は、以下２コマンドを実行し、結果が一致することを確認しています。
　openssl x509 -issuer_hash -noout -in [サーバ証明書]     (サーバ証明書の機関キー識別子)
　　openssl x509 -subject_hash -noout -in [中間証明書]     (中間証明書のサブジェクトキー識別子)


[中間証明書]と[ルート証明書]の比較は、以下２コマンドを実行し、結果が一致することを確認しています。
　openssl x509 -issuer_hash -noout -in [中間証明書]     (中間証明書の機関キー識別子)
　openssl x509 -subject_hash -noout -in [ルート証明書]     (ルート証明書のサブジェクトキー識別子)

